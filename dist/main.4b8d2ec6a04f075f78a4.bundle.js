webpackJsonp([1],{0:function(e,t,n){e.exports=n("x35b")},"1kG0":function(e,t){e.exports='<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" style="line-height: 2.68">\n  <a class="navbar-brand" routerLink="/" routerLinkActive="active"\n     [routerLinkActiveOptions]="{exact:true}">\n    Glaucoma Risk Calculator\n  </a>\n\n  <div class="collapse navbar-collapse" id="navbarsExampleDefault">\n    <form class="form-inline col btn-group" *ngIf="authService.loggedIn()">\n      <a class="nav-item nav-link btn btn-outline-info" routerLinkActive="active" routerLink="/admin/dashboard">\n        Dashboard\n      </a>\n      <button class="a nav-item nav-link btn" (click)="logout()">\n        Logout\n      </button>\n    </form>\n    <ul class="navbar-nav mr-auto"></ul>\n    <a href="http://glaucoma.org.au"><img src="../../assets/reversed-logo.png" alt="logo"/></a>\n  </div>\n\n</nav>\n\n<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top"\n     *ngIf="alertsService.alerts">\n  <app-alerts style="width: 100%"></app-alerts>\n</nav>\n'},"3wRP":function(e,t){e.exports='<form [formGroup]="form">\n  <quill-editor #editor id="{{elementId}}" [style]="{height: \'200px\'}"\n                (onEditorCreated)="setFocus($event)"\n                [formControl]="form.controls[\'editor\']"></quill-editor>\n</form>\n'},"4nrF":function(e,t){e.exports='<main *ngIf="!submitted">\n  <h5>Complete the following to calculate your risk of developing glaucoma, and what to do about it.</h5>\n\n  <form [formGroup]="riskForm" *ngIf="active" (ngSubmit)="onSubmit()">\n    <span class="form-check-label label" style="padding-left: 0">Gender</span>\n    <fieldset class="form-group" id="gender" name="gender">\n      <div class="form-check">\n        <label class="form-check-label">\n          <input type="radio" class="form-check-input" name="gender" id="male" value="male"\n                 formControlName="gender" tabindex="0">\n          Male\n        </label>\n      </div>\n      <div class="form-check">\n        <label class="form-check-label">\n          <input type="radio" class="form-check-input" name="gender" id="female" value="female"\n                 formControlName="gender">\n          Female\n        </label>\n      </div>\n      <div *ngIf="formErrors.gender" class="alert alert-danger">\n        {{ formErrors.gender }}\n      </div>\n    </fieldset>\n\n    <div class="form-group">\n      <label for="age">Age</label>\n      <input type="number" id="age" class="form-control"\n             formControlName="age" placeholder="Specify age">\n    </div>\n\n    <div class="form-group">\n      <label for="ethnicity">Ethnicity</label>\n      <ngx-select [items]="ethnicities"\n                  (selected)="selected_ethnicity($event)"\n                  (data)="selected_ethnicity($event)"\n                  (close)="doClose()"\n                  id="ethnicity" formControlName="ethnicity"\n                  placeholder="Search for ethnicity">\n      </ngx-select>\n    </div>\n\n    <div class="container-fluid">\n      <div class="row">\n        <fieldset class="col-sm">\n          <legend>Family history of glaucoma</legend>\n\n          <div class="form-check form-check-inline container">\n            <div class="row">\n              <label class="form-check-label col col-sm">\n                Parent\n                <input class="form-control form-check-input" type="checkbox" id="parent" formControlName="parent">\n              </label>\n              <label class="form-check-label col col-sm">\n                Sibling\n                <input class="form-control form-check-input" type="checkbox" id="sibling" formControlName="sibling">\n              </label>\n            </div>\n          </div>\n        </fieldset>\n\n        <fieldset class="col-sm">\n          <legend>Other health issues</legend>\n\n          <div class="form-check form-check-inline container">\n            <div class="row">\n              <label class="form-check-label col col-sm">\n                Myopia\n                <input class="form-control form-check-input" type="checkbox" id="myopia" formControlName="myopia">\n              </label>\n              <label class="form-check-label col col-sm">\n                Diabetes\n                <input class="form-control form-check-input" type="checkbox" id="diabetes" formControlName="diabetes">\n              </label>\n            </div>\n          </div>\n        </fieldset>\n\n        <div class="col-sm" style="padding-top: 15px">\n          <button type="submit" class="submit btn " style="width: 100%; height: 100%"\n                  [class.btn-primary]="riskForm.valid"\n                  [class.btn-outline-secondary]="!riskForm.valid"\n                  [disabled]="!riskForm.valid">\n            Calculate risk\n          </button>\n        </div>\n      </div>\n    </div>\n  </form>\n</main>\n\n<app-risk-quiz-form-submitted [riskQuiz]="riskQuiz" [(submitted)]="submitted" *ngIf="submitted">\n</app-risk-quiz-form-submitted>\n'},"5LyI":function(e,t){e.exports="body {\n  padding-top: 150px;\n}\n"},"5xMp":function(e,t){e.exports='<header [ngStyle]="getBottom()">\n  <app-navbar></app-navbar>\n</header>\n\n<div class="container">\n  <router-outlet></router-outlet>\n</div>\n\x3c!--\n<hr>\n\n<div class="container">\n  <div class="row offset-sm-9">\n    <button class="btn btn-lg btn-danger"\n            (click)="addAlert()">Add alert</button>\n  </div>\n</div>\n--\x3e\n<hr>\n\n<app-footer></app-footer>\n'},"7zrD":function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n("WT6e"),i=n("g5jc"),o=n("4zOZ"),s=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(){this.navbarPaddingChange=new i.a,this._navbarPadding=16,this.navbarPadding$=new o.a(this._navbarPadding)}return Object.defineProperty(e.prototype,"navbarPadding",{get:function(){return this._navbarPadding},set:function(e){this._navbarPadding=e,this.navbarPadding$.next(this._navbarPadding)},enumerable:!0,configurable:!0}),e=s([Object(r.Injectable)(),a("design:paramtypes",[])],e)}()},"8xD6":function(e,t){e.exports=""},Csc2:function(e,t){e.exports='<app-richtext [elementId]="\'contents\'" (onEdited)="onEdited($event)" #editor>\n</app-richtext>\n\n<form class="form-group" [formGroup]="form">\n  <label for="email_subject">Email subject</label>\n  <input placeholder="Email subject" id="email_subject" name="email_subject" formControlName="email_subject"\n         class="form-control" required/>\n\n  <label for="twitter">Twitter</label>\n  <textarea class="form-control" [ngClass]="{\'red-border\': !validTwitterLength()}"\n            placeholder="Twitter" id="twitter" formControlName="twitter" required>\n  </textarea>\n  <small class="form-text text-muted">\n    <code [ngClass]="{\'text-muted\': validTwitterLength()}">{{form.value.twitter.length}}</code> characters\n  </small>\n\n  <label for="facebook">Facebook</label>\n  <textarea class="form-control" placeholder="Facebook" id="facebook" formControlName="facebook" required></textarea>\n  <small class="form-text text-muted">\n    <code class="text-muted">{{form.value.facebook.length}}</code> characters\n  </small>\n\n  <button type="submit" class="btn btn-info btn-lg" style="margin-top: 1em"\n          (click)="save()" [disabled]="!validTwitterLength() || !form.valid">\n    Save\n  </button>\n</form>\n'},DBiG:function(e,t){e.exports=""},FQYD:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("WT6e"),i=n("Xjw4"),o=n("bfOx"),s=n("7DMc"),a=n("dcgx"),c=n("OZ26"),l=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,r){this.router=e,this.fb=t,this.authService=n,this.alertsService=r,this.auth=new s.b}return e.prototype.ngOnInit=function(){this.form=this.fb.group({email:["",[s.h.required,s.h.email]],password:["",s.h.required]})},e.prototype.login=function(){var e=this;this.authService.login(this.form.value).subscribe(function(t){var n;null!=t.access_token?(e.authService.access_token=t.access_token,localStorage.setItem("access-token",e.authService.access_token),e.router.navigate([(n="/admin",new URLSearchParams(window.location.search.slice(1)).get("redirectUrl")||n)]).then(function(){})):e.alertsService.add("No access token; try logging in again")})},e=l([Object(r.Component)({selector:"app-login",template:n("Y0uS"),styles:[n("cbOW")]}),u("design:paramtypes",[o.b,s.a,a.a,c.a])],e)}(),p=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e){this.authService=e}return e.prototype.ngOnInit=function(){this.authService.logout()},e=p([Object(r.Component)({selector:"app-logout",template:"<ng-content></ng-content>"}),d("design:paramtypes",[a.a])],e)}(),m=[{path:"auth",component:f},{path:"auth/login",component:f},{path:"auth/logout",component:h}];n.d(t,"AuthModule",function(){return b});var g=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},b=function(){function e(){}return e=g([Object(r.NgModule)({imports:[i.CommonModule,o.c,o.c.forChild(m),s.c,s.g],providers:[a.a],declarations:[f,h]})],e)}()},FrLf:function(e,t){e.exports='<div class="container-fluid">\n  <div class="row" *ngIf="error">\n    <h3>Trace</h3>\n    <pre>{{error}}</pre>\n  </div>\n\n  <div class="row">\n    <div class="col-9">\n      <app-template></app-template>\n    </div>\n    <div class="col">\n      <app-ms-auth></app-ms-auth>\n    </div>\n  </div>\n</div>\n'},"GFD+":function(e,t){e.exports=""},IH5k:function(e,t){e.exports=""},Igq0:function(e,t){e.exports='<div class="container">\n  <div class="row">\n    <a type="button" class="col btn btn-lg btn-warning" (click)="login()" *ngIf="!loggedIn()">\n      Authenticate with Office 365\n    </a>\n\n    <button class="col btn btn-sm btn-outline-danger"\n            (click)="logout()" *ngIf="loggedIn()">\n      Office 365 logout\n    </button>\n    <button type="button" class="col-sm-2 btn btn-sm" (click)="toggleCollapse()">Advanced</button>\n  </div>\n</div>\n\n<form *ngIf="loggedIn() && email_form" (ngSubmit)="sendTestEmail()" [formGroup]="email_form">\n  <div class="form-group">\n    <label for="test_recipient">Recipient</label>\n    <input type="email" class="form-control" id="test_recipient" name="test_recipient" formControlName="test_recipient"\n           aria-describedby="emailHelp" placeholder="Enter email address">\n    <small id="emailHelp" class="form-text text-muted">Address to send email</small>\n  </div>\n\n  <div class="form-group">\n    <label for="test_subject">Subject</label>\n    <input type="text" class="form-control" id="test_subject" name="test_subject" formControlName="test_subject"\n           aria-describedby="subjectHelp" placeholder="Enter subject">\n    <small id="subjectHelp" class="form-text text-muted">Subject of email</small>\n  </div>\n\n  <button class="btn btn-lg btn-primary" type="submit">Send test email</button>\n</form>\n\n<hr *ngIf="!isCollapsed">\n\n<div [collapse]="isCollapsed" class="card card-block card-header">\n  <div class="well well-lg">\n    More info:\n    <a href="https://graph.microsoft.io/en-us/docs/authorization/app_authorization" target="_blank">\n      Microsoft Graph app authorisation\n    </a>\n    <form (ngSubmit)="updateAuth()" [formGroup]="advanced_form">\n      <div class="form-group">\n        <label for="client_id">Client ID</label>\n        <input type="text" class="form-control"\n               id="client_id" name="client_id" formControlName="client_id"\n               placeholder="Enter client_id">\n      </div>\n\n      <div class="form-group">\n        <label for="client_secret">Client Secret</label>\n        <input type="text" class="form-control"\n               id="client_secret" name="client_secret" formControlName="client_secret"\n               placeholder="Enter client_secret">\n      </div>\n\n      <div class="form-group">\n        <label for="tenant_id">Tenant ID</label>\n        <input type="text" class="form-control"\n               id="tenant_id" name="tenant_id" formControlName="tenant_id"\n               placeholder="Enter tenant_id">\n      </div>\n\n      <button class="btn btn-outline-warning" type="submit">Update auth</button>\n    </form>\n  </div>\n</div>\n\n'},Jnfr:function(e,t,n){var r={"app/auth/auth.module":["FQYD"]};function i(e){var t=r[e];return t?Promise.all(t.slice(1).map(n.e)).then(function(){return n(t[0])}):Promise.reject(new Error("Cannot find module '"+e+"'."))}i.keys=function(){return Object.keys(r)},i.id="Jnfr",e.exports=i},OZ26:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("WT6e"),i=n("7zrD"),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.appService=e,this.alerts=[],this._padding=4.5}return e.prototype.add=function(e){var t;null!=e&&(e.type&&e.msg?this.alerts.push({type:e.type,msg:(t=e.msg,"string"==typeof t?t:t.status+": "+t.statusText+" on "+t.url)}):this.alerts.push({type:"warning",msg:"string"==typeof e?e:e.hasOwnProperty("error")&&e.hasOwnProperty("error_message")?Object.values(e).join(": "):Object.keys(e).map(function(t){return e[t]}).join("\t")}),this.appService.navbarPadding+=this._padding)},e.prototype.close=function(e){this.alerts.splice(e,1),this.appService.navbarPadding-=this._padding},e=o([Object(r.Injectable)(),s("design:paramtypes",[i.a])],e)}()},QjeQ:function(e,t){e.exports='<div class="row">\n  <div class="col-md-4">\n    <input *ngIf="config.filtering" placeholder="Filter all columns"\n           [ngTableFiltering]="config.filtering"\n           class="form-control"\n           (tableChanged)="onChangeTable(config)"/>\n  </div>\n</div>\n<br>\n<ng-table [config]="config"\n          (tableChanged)="onChangeTable(config)"\n          (cellClicked)="onCellClick($event)"\n          [rows]="users" [columns]="columns">\n</ng-table>\n<pagination *ngIf="config.paging"\n            class="pagination-sm"\n            [(ngModel)]="page"\n            [totalItems]="length"\n            [itemsPerPage]="itemsPerPage"\n            [maxSize]="maxSize"\n            [boundaryLinks]="true"\n            [rotate]="false"\n            (pageChanged)="onChangeTable(config, $event)"\n            (numPages)="numPages = $event">\n</pagination>\n<pre *ngIf="config.paging" class="card card-block card-header">Page: {{page}} / {{numPages}}</pre>\n\n'},REyt:function(e,t){e.exports=".red-border {\n  border: solid 0.1em red !important;\n}\n\n.btn-info.disabled, .btn-info:disabled {\n  background-color: darkgrey;\n  border-color: #9E9E9E;\n}\n"},Rpt0:function(e,t){e.exports='<div class="jumbotron">\n  <div class="container">\n    <h1 class="display-4">Administrator interface</h1>\n    <p>Herein you can edit email templates, and modify email API details.</p>\n  </div>\n</div>\n\n<div class="container">\n  <div class="row">\n    <div class="col-md-6">\n      <a class="btn btn-block btn-outline-primary" routerLink="/admin/email" routerLinkActive="active">\n        <i class="icon-mail"></i> Manage email and social\n      </a>\n      <p>Edit email and social templates, modify authentication details</p>\n    </div>\n    <div class="col-md-6">\n      <button class="btn btn-block btn-outline-danger" routerLink="/admin/users" routerLinkActive="active">\n        <i class="icon-users"></i>Users\n      </button>\n      <p>View/search users</p>\n    </div>\n  </div>\n</div>\n'},SiWZ:function(e,t){e.exports="legend {\n  font-size: medium;\n  font-weight: bold;\n}\n\n.form-check-label {\n  font-weight: unset;\n}\n\nlabel, .label {\n  font-weight: bold;\n}\n\n.btn:not(:disabled):not(.disabled) {\n  font-weight: bold;\n}\n"},T7K8:function(e,t){e.exports="/*\n * Top navigation\n * Hide default border to remove 1px line.\n */\n.navbar-fixed-top {\n  border: 0;\n}\n"},UfTw:function(e,t){e.exports=""},Y0uS:function(e,t){e.exports='<h1 class="mat-h1">Login</h1>\n\n<form class="form-signin-up" #formRef="ngForm" (ngSubmit)="login()"\n      *ngIf="!authService.loggedIn()" [formGroup]="form" novalidate>\n  <label for="email" class="sr-only">Email address</label>\n  <input class="form-control" formControlName="email" type="email" name="email" id="email" placeholder="Email">\n\n  <label for="password" class="sr-only">Password</label>\n  <input class="form-control" formControlName="password" type="password" name="password" id="password"\n         placeholder="Password">\n\n\n  <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>\n</form>\n\n<p *ngIf="authService.loggedIn()">You are logged in.</p>\n'},cbOW:function(e,t){e.exports=""},cmvB:function(e,t){e.exports=""},dcgx:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n("WT6e"),i=n("ItHS"),o=n("bfOx"),s=n("YaPU"),a=(n("xgm2"),n("owTz"),n("MDfR"),n("OZ26")),c=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,n,r){this.http=e,this.router=n,this.alertsService=r,this.loggedIn=t.loggedIn;var i=localStorage.getItem("access-token");null!=i&&(this.access_token=i)}return t=e,e.loggedIn=function(){return null!==localStorage.getItem("access-token")},e.getAccessToken=function(){return localStorage.getItem("access-token")},e.prototype.logout=function(){["access-token","user"].forEach(function(e){return localStorage.removeItem(e)}),this.router.navigate(["/"],"/auth/logout"===this.router.url?{}:{queryParams:{redirectUrl:this.router.url}})},e.prototype.login=function(e){return localStorage.setItem("user",e.email),this.http.post("/api/auth",e)},e.prototype.register=function(e){return localStorage.setItem("user",e.email),this.http.post("/api/user",e,{observe:"response"})},e.prototype.signinup=function(e){var t=this;return this.login(e).catch(function(n){return n&&n.error&&n.error.message&&"User not found"===n.error.message?t.register(e).map(function(e){return Object.assign(e.body,{access_token:e.headers.get("X-Access-Token")})}):t.alertsService.add(n.error.message)||s.a.throw(n.error)})},e=t=c([Object(r.Injectable)(),l("design:paramtypes",[i.b,o.b,a.a])],e);var t}()},e6R8:function(e,t){e.exports="ng-gauge {\n  margin: 16px;\n  width: 300px;\n  height: 300px;\n  display: inline-block;\n}\n"},f6ft:function(e,t){e.exports='<footer class="footer container">\n  <div class="row align-items-start">\n    <app-api-version class="col grey"></app-api-version>\n    <a routerLink="/auth" class="col grey text-center">auth</a>\n    <span class="col text-right">&copy; Glaucoma Australia, 2018.</span>\n  </div>\n</footer>\n'},lEF6:function(e,t){e.exports='<table class="table">\n  <tbody>\n  <tr>\n    <td [style.background]="numToColour(0)"></td>\n    <td [style.background]="numToColour(25)"></td>\n    <td [style.background]="numToColour(50)"></td>\n    <td [style.background]="numToColour(75)"></td>\n    <td [style.background]="numToColour(100)"></td>\n  </tr>\n  <tr>\n    <td id="0">{{risk_value}}</td>\n    <td id="1"></td>\n    <td id="2"></td>\n    <td id="3"></td>\n    <td id="4"></td>\n    <td id="5"></td>\n  </tr>\n  </tbody>\n</table>\n'},mIxc:function(e,t){e.exports=".grey {\n  color: gainsboro;\n}\n"},mR2D:function(e,t){e.exports=""},okgc:function(e,t){e.exports="a {\n  text-decoration: none;\n}\n\na.active {\n  font-weight: bold;\n}\n\nhtml {\n  position: relative;\n  min-height: 100%;\n}\n"},vqKx:function(e,t){e.exports='<ng-container *ngIf="serverStatus.version">\n  {{serverStatus.version}}\n</ng-container>\n'},x35b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("WT6e"),i=n("4PVY"),o=n("OE0E"),s=n("ItHS"),a=n("7DMc"),c=n("bfOx"),l=n("Xjw4"),u=n("Exih"),f=n("OZ26"),p=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e){this.alertsService=e,this.type="warning"}return e.prototype.ngOnInit=function(){},e.prototype.addAlert=function(e){this.alertsService.add(e)},e.prototype.closeAlert=function(e){this.alertsService.close(e)},p([Object(r.Input)(),d("design:type",Object)],e.prototype,"type",void 0),p([Object(r.Input)(),d("design:type",Boolean)],e.prototype,"dismissible",void 0),p([Object(r.Input)(),d("design:type",Number)],e.prototype,"dismissOnTimeout",void 0),e=p([Object(r.Component)({selector:"app-alerts",template:n("y69F"),styles:[n("5LyI")]}),d("design:paramtypes",[f.a])],e)}(),m=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},g=function(){function e(){}return e.forRoot=function(){return{ngModule:u.a,providers:[f.a]}},e=m([Object(r.NgModule)({imports:[l.CommonModule,u.a.forRoot()],declarations:[h],exports:[h]})],e)}(),b=n("dcgx"),v=n("7zrD"),y=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},k=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(){function e(e,t,n,r){this.router=e,this.appService=t,this.authService=n,this.alertsService=r}return e.prototype.logout=function(){var e=this;this.router.navigate(["auth/logout"]).then(function(t){return t?console.info("NavbarComponent::state changed"):e.alertsService.alerts.push({msg:"state didn't change",type:"warning"})},function(t){return e.alertsService.alerts.push({msg:t,type:"danger"})})},e=y([Object(r.Component)({selector:"app-navbar",template:n("1kG0"),styles:[n("T7K8")]}),k("design:paramtypes",[c.b,v.a,b.a,f.a])],e)}(),j=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},O=function(){function e(){}return e=j([Object(r.NgModule)({imports:[l.CommonModule,c.c,u.a,g],declarations:[_],exports:[_]})],e)}(),R=n("rMpt"),S=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},w=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},x=function(){function e(e){this.alertsService=e}return e.prototype.ngAfterViewInit=function(){if(this.alertsService.alerts&&this.alertsService.alerts.length){var e=this.alertsService.alerts[this.alertsService.alerts.length-1];e.msg&&e.msg.length&&e.msg.indexOf("interaction_required")>-1&&(this.error=e.msg)}},e=S([Object(r.Component)({selector:"app-email",template:n("FrLf"),styles:[n("UfTw")]}),w("design:paramtypes",[f.a])],e)}(),P=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},C=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},A=function(){function e(e){this.http=e}return e.prototype.post=function(e){return this.http.post("/api/user",e)},e.prototype.getAll=function(){return this.http.get("/api/users")},e=P([Object(r.Injectable)(),C("design:paramtypes",[s.b])],e)}(),I=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},z=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Q=function(){function e(e){this.userService=e,this.users=[],this.columns=[{title:"email",name:"email",filtering:{filterString:"",placeholder:"Filter by email"}},{title:"updatedAt",className:["office-header","text-success"],name:"updatedAt",sort:"asc"},{title:"createdAt.",name:"createdAt"}],this.config={paging:!0,sorting:{columns:this.columns},filtering:{filterString:""},className:["table-striped","table-bordered"]},this.page=1,this.itemsPerPage=10,this.maxSize=5,this.numPages=1,this.length=0}return e.prototype.ngOnInit=function(){var e=this;this.userService.getAll().map(function(e){return e.users}).subscribe(function(t){return e.users=t},console.error),this.onChangeTable(this.config)},e.prototype.changePage=function(e,t){void 0===t&&(t=this.users);var n=(e.page-1)*e.itemsPerPage,r=e.itemsPerPage>-1?n+e.itemsPerPage:t.length;return t.slice(n,r)},e.prototype.changeSort=function(e,t){if(!t.sorting)return e;for(var n=this.config.sorting.columns||[],r=void 0,i=void 0,o=0;o<n.length;o++)""!==n[o].sort&&!1!==n[o].sort&&(r=n[o].name,i=n[o].sort);return r?e.sort(function(e,t){return e[r]>t[r]?"desc"===i?-1:1:e[r]<t[r]?"asc"===i?-1:1:0}):e},e.prototype.changeFilter=function(e,t){var n=this,r=e;if(this.columns.forEach(function(e){e.filtering&&(r=r.filter(function(t){return t[e.name].match(e.filtering.filterString)}))}),!t.filtering)return r;if(t.filtering.columnName)return r.filter(function(e){return e[t.filtering.columnName].match(n.config.filtering.filterString)});var i=[];return r.forEach(function(e){var t=!1;n.columns.forEach(function(r){e[r.name].toString().match(n.config.filtering.filterString)&&(t=!0)}),t&&i.push(e)}),r=i},e.prototype.onChangeTable=function(e,t){void 0===t&&(t={page:this.page,itemsPerPage:this.itemsPerPage}),e.filtering&&Object.assign(this.config.filtering,e.filtering),e.sorting&&Object.assign(this.config.sorting,e.sorting);var n=this.changeFilter(this.users,this.config),r=this.changeSort(n,this.config);this.users=t&&e.paging?this.changePage(t,r):r,this.length=r.length},e.prototype.onCellClick=function(e){console.log(e)},e=I([Object(r.Component)({selector:"app-users",template:n("QjeQ"),styles:[n("mR2D")]}),z("design:paramtypes",[A])],e)}(),E=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},T=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},D=function(){function e(e,t){this.router=e,this.alertsService=t}return e.prototype.canActivate=function(e,t){if(b.a.loggedIn())return!0;var n=t.url;return this.alertsService.add("Auth required to view "+n),this.router.navigate(["/auth"],{queryParams:{redirectUrl:n}}).then(function(){}),!1},e=E([Object(r.Injectable)(),T("design:paramtypes",[c.b,f.a])],e)}(),M=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},F=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},N=function(){function e(e){this.router=e}return e=M([Object(r.Component)({selector:"app-dashboard",template:n("Rpt0"),styles:[n("DBiG")]}),F("design:paramtypes",[c.b])],e)}(),q=[{path:"admin/dashboard",component:N,canActivate:[D]},{path:"admin/users",component:Q,canActivate:[D]},{path:"admin/email",component:x,canActivate:[D]}],G=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},U=function(){function e(){}return e=G([Object(r.NgModule)({imports:[l.CommonModule,c.c.forChild(q),a.c,u.d.forRoot(),u.e,R.Ng2TableModule],providers:[A],declarations:[Q]})],e)}(),L=n("YaPU"),V=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},B=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},W=function(){function e(e){this.http=e}return e.prototype.get=function(){var e=this;return this.config?L.a.of(this.config):this.http.get("/api/config").map(function(t){return e.config=t})},e.prototype.post=function(e){var t=this;return this.http.post("/api/config",e).map(function(e){return t.config=e})},e=V([Object(r.Injectable)(),B("design:paramtypes",[s.b])],e)}(),H=n("HOy/"),Y=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},$=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},J=function(){function e(e){this.fb=e,this.onEdited=new r.EventEmitter}return e.prototype.ngOnInit=function(){this.form=this.fb.group({editor:""})},e.prototype.ngAfterViewInit=function(){var e=this;this.form.valueChanges.subscribe(function(t){return e.onEdited.emit(t.editor)})},e.prototype.setFocus=function(e){e.focus()},e.prototype.patchValue=function(e){this.form.controls.editor.patchValue(e||this.form.controls.editor.value+" patched!")},e.prototype.setValue=function(e){this.form.setValue({editor:e||""})},Y([Object(r.Input)(),$("design:type",String)],e.prototype,"elementId",void 0),Y([Object(r.Output)(),$("design:type",r.EventEmitter)],e.prototype,"onEdited",void 0),Y([Object(r.ViewChild)("editor"),$("design:type",H.a)],e.prototype,"editor",void 0),e=Y([Object(r.Component)({selector:"app-richtext",template:n("3wRP"),styles:[n("cmvB")]}),$("design:paramtypes",[a.a])],e)}(),Z=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},X=function(){function e(){}return e=Z([Object(r.NgModule)({imports:[l.CommonModule,a.g,H.b],declarations:[J],exports:[J]})],e)}(),K=(n("owTz"),n("xgm2"),this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}),ee=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},te=function(){function e(e,t){this.http=e,this.alertsService=t,this.templates=new Map}return e.prototype.hasTpl=function(e){return void 0===e&&(e="email"),this.templates.has(e)&&this.templates.get(e).contents&&this.templates.get(e).contents.length>0},e.prototype.setTpl=function(e,t){void 0===t&&(t="email"),this.hasTpl(t)?this.templates.get(t).contents=e:this.templates.set(t,{contents:e,createdAt:(new Date).toISOString()})},e.prototype.getTpl=function(e){return void 0===e&&(e="email"),this.templates.has(e)?this.templates.get(e).contents:void 0},e.prototype.create=function(e){return this.http.post("/api/template",e)},e.prototype.createBatch=function(e){return this.http.post("/api/templates",{templates:e})},e.prototype.read=function(e,t){return void 0===t&&(t="email"),this.http.get("/api/template/"+e+"_"+t)},e.prototype.readBatch=function(){var e=this;return this.http.get("/api/templates/latest").map(function(t){return t.templates.forEach(function(t){return e.templates.set(t.kind,t)}),t}).catch(function(t){return e.alertsService.add(t)||L.a.throw(t)})},e.prototype.update=function(e,t){return this.http.put("/api/template/"+e.createdAt,t)},e.prototype.destroy=function(e,t){return void 0===t&&(t="email"),this.http.delete("/api/template/"+e+"_"+t)},e=K([Object(r.Injectable)(),ee("design:paramtypes",[s.b,f.a])],e)}(),ne=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},re=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ie=function(){function e(e,t,n){this.fb=e,this.alertsService=t,this.templateService=n,this.form=this.fb.group({email_subject:["",a.h.required],twitter:["",[a.h.required,a.h.maxLength(240)]],facebook:["",a.h.required]})}return e.prototype.ngOnInit=function(){},e.prototype.ngAfterViewInit=function(){var e=this;this.templateService.readBatch().subscribe(function(){var t=Array.from(e.templateService.templates.keys()).filter(function(e){return"email"!==e}).reduce(function(t,n){return Object.assign(t,((r={})[n]=e.templateService.getTpl(n),r));var r},{});Object.keys(t).length&&(e.editor.setValue(e.templateService.getTpl("email")),e.form.setValue(t))})},e.prototype.save=function(){for(var e=this,t=(new Date).toISOString(),n=[{contents:this.templateService.getTpl("email"),kind:"email",createdAt:t}].concat(Object.keys(this.form.value).map(function(n){return{kind:n,contents:e.form.value[n],createdAt:t}})),r=!1,i=0,o=n;i<o.length;i++){var s=o[i];(!s.contents||s.contents.length<1)&&("email"!==s.kind?this.form.controls[s.kind].setErrors({incorrect:!0}):this.editor.form.setErrors({incorrect:!0}),r=!0)}r?(this.form.markAsDirty(),this.alertsService.add({type:"warning",msg:"Add template for each"})):this.tplBatchCreate(n,function(t,n){null!=t?e.alertsService.add(t):e.alertsService.add({type:"info",msg:"Updated templates"})})},e.prototype.tplCreate=function(e,t){var n=this;if(null==e)return t(new TypeError("new_template must be defined"));this.templateService.create(e).subscribe(function(e){return n.handleTemplate(e,e.kind,t)},this.handleError.bind(this))},e.prototype.tplBatchCreate=function(e,t){var n=this;if(null==e)return t(new TypeError("new_templates must be defined"));this.templateService.createBatch(e).subscribe(function(e){return e.templates.forEach(function(e){return n.handleTemplate(e,e.kind)}),t(void 0,e)},t)},e.prototype.tplRead=function(e,t,n){var r=this;this.templateService.read(e,t).subscribe(function(e){return r.templateService.templates.set(t,e),n(void 0,e)},function(e){return r.alertsService.add({type:"warning",msg:e}),n(e)})},e.prototype.onEdited=function(e){this.templateService.setTpl(e)},e.prototype.init=function(e){var t=this;this.tplRead("latest",e,function(e,n){return!e&&n&&t.editor.patchValue(n.contents)})},e.prototype.handleTemplate=function(e,t,n){if(this.templateService.templates.set(t,e),n)return n(void 0,e)},e.prototype.tplDestroy=function(e){this.templateService.destroy(e).subscribe(function(e){return e},this.handleError.bind(this))},e.prototype.handleError=function(e){this.alertsService.add({type:"warning",msg:e})},e.prototype.validTwitterLength=function(){return this.form.value.twitter.length<240},ne([Object(r.ViewChild)("editor"),re("design:type",J)],e.prototype,"editor",void 0),e=ne([Object(r.Component)({selector:"app-template",template:n("Csc2"),styles:[n("REyt")]}),re("design:paramtypes",[a.a,f.a,te])],e)}(),oe=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},se=function(){function e(){}return e=oe([Object(r.NgModule)({imports:[l.CommonModule,a.c,a.g,X],declarations:[ie],exports:[ie]})],e)}(),ae=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},ce=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},le=function(e){for(var t,n={},r=/([^&=]+)=([^&]*)/g;t=r.exec(e);)n[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return n},ue=function(){function e(e,t,n,r){this.http=e,this.router=t,this.configService=n,this.alertsService=r,this.params=le(location.hash),this.init()}return t=e,e.genNonce=function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvwxyz",t=new Uint8Array(32),n=[];return window.crypto.getRandomValues(t),t.forEach(function(t){return n.push(e[t%e.length])}),n.join("")},e.getHostOrigin=function(){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},e.paramsToObject=function(e){for(var t={},n=0,r=e.keys();n<r.length;n++){var i=r[n];t[i]=e.get(i)}return console.info("paramsToObject::params:",e,";\ntoObject:",t,";"),t},e.prototype.msAuthRedir=function(e){console.info("MsAuthService::getTokenParams() =",this.getTokenParams(),";"),console.info("MsAuthService::msAuthRedir::params",e.params,";"),window.location.href=""+e.url+e.params},e.prototype.getTokenParams=function(e){return console.info("MsAuthService::getTokenParams::client_id =",this.configService.config.client_id,";"),(new s.f).set("client_id",this.configService.config.client_id).set("redirect_uri",t.getHostOrigin()).set("state",e||window.location.pathname).set("nonce",t.genNonce())},e.prototype.login=function(e,t,n){var r=this;if(null!=e){switch(this.params[e]=t,console.info("MsAuthService::login::params =",this.params,";"),console.info("MsAuthService::login::token_type",e,";"),console.info("MsAuthService::login::token:",t,"of type",typeof t,";"),e){case"code":null!=t&&"undefined"!==t||this.msAuthRedir(this.getCode(n)),localStorage.setItem("ms::"+e,t),this.login("refresh_token",void 0,n);break;case"access_token":case"refresh_token":null!=t&&"undefined"!==t||this.getTokens().subscribe(function(e){return Object.keys(e).forEach(function(t){return localStorage.setItem("ms::#"+t,e[t])})},function(e){var t=JSON.parse(e.error_message);console.error(t.headers);var n=JSON.parse(t.method);r.alertsService.add(n.error+": "+n.error_description)})}this.router.navigateByUrl(null==n?"/":decodeURIComponent(n))}},e.prototype.logout=function(){Object.keys(localStorage).forEach(function(e){return e.startsWith("ms::")&&localStorage.removeItem(e)})},e.prototype.init=function(){this.configService.get().subscribe(function(){})},e.prototype.localSendEmail=function(e){var t=this,n={headers:new s.e({"Content-Type":"application/json",Authorization:"Bearer "+this.configService.config.access_token}),observe:"response"},r={message:{subject:e.subject,toRecipients:[{emailAddress:{address:e.recipient}}],body:{content:e.content,contentType:"html"}}};return this.http.post("https://graph.microsoft.com/v1.0/users/me/sendMail",r,n).map(function(e){return 202!==e.status&&L.a.throw(new Error("Expected response.status of 202 got "+e.status+".\n           Body: "+e.body)),e.body}).catch(function(e){var n=JSON.parse(e._body).error;return"Access token has expired."===n.message&&t.login("code"),L.a.throw(n)})},e.prototype.getCode=function(e){var n=t.paramsToObject(this.getTokenParams(e)),r=new s.f({fromObject:Object.keys(n).filter(function(e){return["client_id","response_type","redirect_uri","response_mode","scope","state"].indexOf(e)>-1}).reduce(function(e,t){return Object.assign(e,((r={})[t]=n[t],r));var r},{})}).set("response_type","code").set("response_mode","query").set("scope","https://graph.microsoft.com/mail.send https://graph.microsoft.com/offline_access");return console.info("MsAuthService::getCode::params",r,";"),{params:r,url:"https://login.microsoftonline.com/"+this.configService.config.tenant_id+"/oauth2/v2.0/authorize?"}},e.prototype.getTokens=function(e){var n=t.paramsToObject(this.getTokenParams(e)),r=new s.f({fromObject:Object.keys(n).filter(function(e){return["client_id","grant_type","scope","code","redirect_uri","client_secret"].indexOf(e)>-1}).reduce(function(e,t){return Object.assign(e,((r={})[t]=n[t],r));var r},{})}).set("grant_type","authorization_code").set("scope","https://graph.microsoft.com/mail.send https://graph.microsoft.com/offline_access").set("code",localStorage.getItem("ms::code")).set("client_secret",this.configService.config.client_secret);return console.info("MsAuthService::getTokens::params",r,";"),this.http.post("/api/email/ms-auth",t.paramsToObject(r))},e.prototype.remoteSendEmail=function(e,t){return this.http.post("/api/email/"+t.recipient+"/"+e,void 0)},e=t=ae([Object(r.Injectable)(),ce("design:paramtypes",[s.b,c.b,W,f.a])],e);var t}(),fe=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},pe=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},de=function(){function e(e,t,n,r,i){this.fb=e,this.alertsService=t,this.msAuthService=n,this.confService=r,this.templateService=i,this.isCollapsed=!0,this.email_form=this.fb.group({test_recipient:["",a.h.required],test_subject:["",a.h.required]}),this.advanced_form=this.fb.group({client_id:["",a.h.required],client_secret:"",tenant_id:["",a.h.required]})}return e.prototype.ngOnInit=function(){var e=this;this.confService.get().subscribe(function(t){return t&&Object.keys(t).length&&e.advanced_form.setValue(Object.keys(t).reduce(function(e,n){return["client_id","client_secret","tenant_id"].indexOf(n)>-1?Object.assign(((r={})[n]=t[n],r),e):e;var r},{}))})},e.prototype.login=function(){this.msAuthService.login("code")},e.prototype.loggedIn=function(){return null!=localStorage.getItem("ms::access_token")},e.prototype.logout=function(){this.msAuthService.logout()},e.prototype.sendTestEmail=function(){var e=this;console.info("MsAuthComponent::sendTestEmail"),this.msAuthService.localSendEmail(Object.assign({content:this.templateService.getTpl("email")},Object.keys(this.email_form.value).map(function(t){var n;return(n={})[t.startsWith("test_")?t.slice("sw".length):t]=e.email_form.value[t],n}).reduce(function(e,t){return Object.assign(e,t)},{}))).subscribe(function(t){return console.info(t)||e.alertsService.add({type:"info",msg:"Sent email"})},console.error)},e.prototype.toggleCollapse=function(){this.isCollapsed=!this.isCollapsed},e.prototype.updateAuth=function(){var e=this,t=localStorage.getItem("ms::access_token");this.confService.post(Object.assign(null==t?{}:{access_token:t},this.advanced_form.value)).subscribe(function(t){return console.info(t)||e.alertsService.add({type:"info",msg:"Updated auth"})},console.error.bind(console))},e=fe([Object(r.Component)({selector:"app-ms-auth",template:n("Igq0"),styles:[n("8xD6")]}),pe("design:paramtypes",[a.a,f.a,ue,W,te])],e)}(),he=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},me=function(){function e(){}return e=he([Object(r.NgModule)({imports:[l.CommonModule,a.c,a.g,c.c,u.c.forRoot()],providers:[ue],declarations:[de],exports:[de]})],e)}(),ge=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},be=function(){function e(){}return e=ge([Object(r.NgModule)({imports:[l.CommonModule,a.c,se,me],declarations:[x],providers:[W]})],e)}(),ve=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},ye=function(){function e(){}return e=ve([Object(r.NgModule)({imports:[l.CommonModule,U,be,c.c,c.c.forChild(q)],declarations:[N]})],e)}(),ke=(n("lMWm"),this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}),_e=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},je=function(){function e(e){this.http=e}return e.prototype.get=function(){return this.last_resp?L.a.of(this.last_resp):this.http.get("/api")},e=ke([Object(r.Injectable)(),_e("design:paramtypes",[s.b])],e)}(),Oe=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Re=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Se=function(){function e(e){this.serverStatusService=e,this.serverStatus={}}return e.prototype.ngOnInit=function(){var e=this;this.serverStatus={version:"App 0.0.36-gamma; "},this.serverStatusService.get().subscribe(function(t){return e.serverStatus.version+="API "+t.version},function(){return e.serverStatus.version+="API server not available"})},Oe([Object(r.Input)(),Re("design:type",Object)],e.prototype,"serverStatus",void 0),e=Oe([Object(r.Component)({selector:"app-api-version",template:n("vqKx"),styles:[n("IH5k")]}),Re("design:paramtypes",[je])],e)}(),we=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},xe=function(){function e(){}return e=we([Object(r.NgModule)({imports:[l.CommonModule],providers:[je],declarations:[Se],exports:[Se]})],e)}(),Pe=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Ce=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ae=function(){function e(){}return e=Pe([Object(r.Component)({selector:"app-footer",template:n("f6ft"),styles:[n("mIxc")]}),Ce("design:paramtypes",[])],e)}(),Ie=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},ze=function(){function e(){}return e=Ie([Object(r.NgModule)({imports:[l.CommonModule,c.c,xe],providers:[je],declarations:[Ae],exports:[Ae]})],e)}(),Qe=n("Bj4q"),Ee=n("UoWM"),Te=n("vEim"),De=n("Dfh8"),Me=n("vit7"),Fe=n("8WWY"),Ne=n("dBtz"),qe=n("Sfd1"),Ge=n("yXRu"),Ue=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Le=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ve=function(){function e(e,t){this.authService=e,this.http=t}return e.prototype.create=function(e){return this.http.post("/api/risk_stats",e)},e.prototype.read=function(e){return this.http.get("/api/risk_stats/"+e)},e.prototype.update=function(e,t){return this.http.put("/api/risk_stats/"+e.createdAt,t)},e.prototype.destroy=function(e){return this.http.delete("/api/risk_stats/"+e)},e=Ue([Object(r.Injectable)(),Le("design:paramtypes",[b.a,s.b])],e)}(),Be=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},We=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},He=function(){function e(e){this.http=e}return e.prototype.create=function(e){return this.http.post("/api/risk_res",e)},e.prototype.read=function(e){return this.http.get("/api/risk_res/"+e)},e.prototype.update=function(e,t){return this.http.put("/api/risk_res/"+e,t)},e.prototype.destroy=function(e){return this.http.delete("/api/risk_res/"+e)},e=Be([Object(r.Injectable)(),We("design:paramtypes",[s.b])],e)}(),Ye=n("QttI"),$e=n("YxrS"),Je=(n("VwFy"),function(){function e(e){this.riskQuiz=e}return e.prototype.calcRisk=function(e){this.study=Object($e.ethnicity2study)(e)[this.riskQuiz.ethnicity];var t={study:this.study,age:this.riskQuiz.age,gender:this.riskQuiz.gender};this.risk=+Object($e.risk_from_study)(e,t).toPrecision(4),this.risks=Object($e.risks_from_study)(e,t),this.multiplicative_risks=Object($e.calc_default_multiplicative_risks)(e,{age:this.riskQuiz.age,diabetes:this.riskQuiz.diabetes,myopia:this.riskQuiz.myopia,family_history:this.riskQuiz.sibling||this.riskQuiz.parent})},e.prototype.toJSON=function(){return{age:this.riskQuiz.age,gender:this.riskQuiz.gender,ethnicity:this.riskQuiz.ethnicity,study:this.study,parent:this.riskQuiz.parent,sibling:this.riskQuiz.sibling,myopia:this.riskQuiz.myopia,diabetes:this.riskQuiz.diabetes,client_risk:this.client_risk}},e}()),Ze=Object.freeze({indigo:"#14143e",pink:"#fd1c49",orange:"#ff6e00",yellow:"#f0c800",mint:"#00efab",cyan:"#05d1ff",purple:"#841386",white:"#fff",darkgrey:"darkgrey",teal:"#5AA454",darkred:"#A10A28",gold:"#C7B42C",grey:"#AAAAAA"}),Xe=function(e){return Ye.compare(e,5)<1?Ze.darkgrey:Ye.compare(e,25)<1?Ze.cyan:Ye.compare(e,50)<1?Ze.mint:Ye.compare(e,75)<1?Ze.orange:Ze.pink},Ke=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},et=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Ye.config({number:"BigNumber",precision:5});var tt=function(){function e(e,t,n,i,o,s,a,c){var l=this;this.route=e,this.router=t,this.modalService=n,this.riskStatsService=i,this.riskResService=o,this.templateService=s,this.alertsService=a,this.msAuthService=c,this.submitted=!1,this.most_at_risk="",this.isCollapsed=!0,this.id=void 0,this.progressGraph={bgRadius:60,bgColor:Ze.indigo,rounded:!1,reverse:!1,animationSecs:1,labels:[],segments:[]},this.submittedChange=new r.EventEmitter,this.colorScheme={domain:[Ze.teal,Ze.darkred,Ze.gold,Ze.grey]},this.pieAdvColorScheme=this.colorScheme,this.autoScale=!0,this.pieData=[],this.pieAdvDim=[700,400],this.pieAdvData=[],this.pieAdvLabel="times more at risk",this.pieAdvGradient=!0,this.pie_grid=!1,this.show_pie_adv=!1,this.added_risk=!1,this.gauge=!1,this.show_treemap=!1,this.treemap_legend=[],this.submissionHeader=[],this.labelFormat=function(e){return l.treemap_legend.findIndex(function(t){return t.color===e.data.fill})<0&&l.treemap_legend.push({color:e.data.fill,name:e.data.data.name,value:e.data.data.value}),l.treemap_legend.sort(function(e,t){return e.value<t.value}),{"Chinese [Singapore: urban]":"Chinese","White European (Canadian; Italian; Irish; Welsh; Scottish)":"White (Can.)","White (Northern European: Australian)":"White (Aus.)"}[e.data.data.name]||e.data.data.name}}return e.prototype.redo=function(){this.submittedChange.emit(!1),this.router.navigate(["/"]).catch(console.error)},e.prototype.ngOnInit=function(){var e=this;this.riskQuiz instanceof Je||(this.riskQuiz=new Je(this.riskQuiz)),this.templateService.readBatch().subscribe(function(){return e.tweet.href=e.templateService.getTpl("twitter")})},e.prototype.ngAfterContentInit=function(){var e=this;this.submitted?this.prepareView():this.route.params.switchMap(function(t){return e.id=e.riskResService.id=+t.id,e.riskResService.read(e.id)}).subscribe(function(t){e.riskQuiz=new Je(t),e.submitted=!0,e.prepareView()})},e.prototype.toggleCollapse=function(){this.isCollapsed=!this.isCollapsed},e.prototype.idWithUrl=function(){return ue.getHostOrigin()+"/results/"+this.id},e.prototype.onPieGridSelect=function(e){console.log(e)},e.prototype.pieAdvOnSelect=function(e){console.log(e)},e.prototype.sendEmail=function(e){var t=this;this.msAuthService.remoteSendEmail(this.id,{recipient:e,subject:this.templateService.getTpl("email_subject"),content:this.templateService.getTpl("email")+" "+this.share_url}).subscribe(function(e){return console.info("RiskQuizFormSubmittedComponent::sendEmail::email",e)||t.alertsService.add({type:"info",msg:"Sent email"})},console.error),this.modalRef.hide()},e.prototype.gaugeView=function(e,t){this.progressGraph.labels.push(new Ge.a({color:Ze.white,text:"risk",x:0,y:20,fontSize:"1em"}),new Ge.a({color:Xe(e),text:t,x:0,y:0,fontSize:"2em"})),this.progressGraph.segments.push(new Ge.c({value:e,color:Xe(e),borderWidth:20})),this.gauge=!0},e.prototype.pieAdvView=function(e){this.pieAdvData=Object.keys(e).map(function(t){return{name:t,value:e[t]}}).filter(function(e){return e.value>1}),this.show_pie_adv=this.added_risk=this.riskQuiz.riskQuiz.sibling||this.riskQuiz.riskQuiz.parent},e.prototype.openModal=function(e){this.modalRef=this.modalService.show(e,{class:"modal-sm"})},e.prototype.prepareView=function(){var e=this;this.submissionHeader=Object.keys(this.riskQuiz.riskQuiz).filter(function(e){return-1===["createdAt","updatedAt","id","client_risk"].indexOf(e)}),this.submissionRow=Object.keys(this.riskQuiz.riskQuiz).map(function(t){return(n={})[t]=null!=e.riskQuiz.riskQuiz[t]&&e.riskQuiz.riskQuiz[t],n;var n}).reduce(function(e,t){return Object.assign(e,t)},{}),this.riskStatsService.read("latest").subscribe(function(t){e.riskStatsService.risk_json=t.risk_json;try{e.riskQuiz.calcRisk(e.riskStatsService.risk_json)}catch(t){e.router.navigate(["/"]).catch(console.error)}e.html_of_all_refs=JSON.parse(e.riskStatsService.risk_json.html_of_all_refs),e.html_of_last_note=e.riskStatsService.risk_json.global_notes.pop(),e.notes=e.riskStatsService.risk_json.global_notes,e.riskStatsService.risk=e.riskQuiz.risk,e.riskQuiz.ref=e.riskStatsService.risk_json.studies[e.riskQuiz.study].ref;var n,r,i=Object($e.familial_risks_from_study)(e.riskStatsService.risk_json,e.riskQuiz.toJSON()),o=(n=Ye.multiply(Ye.divide(e.riskQuiz.risks.lastIndexOf(e.riskQuiz.risk)+1,e.riskQuiz.risks.length),100),(r=i.reduce(function(e,t){return e+t},1)+n)>100?100:r),s=function(e){switch(!0){case Ye.smallerEq(e,25):return"least";case Ye.smallerEq(e,50):return"average";case Ye.smallerEq(e,75):return"2nd greatest";case Ye.larger(e,75):default:return"greatest"}}(o);e.most_at_risk=e.riskQuiz.risks.lastIndexOf(e.riskQuiz.risk)+1+" / "+e.riskQuiz.risks.length,e.riskQuiz.relative_risks=Object($e.calc_relative_risk)(e.riskStatsService.risk_json,e.riskQuiz.riskQuiz),e.show_treemap=!0,e.gaugeView(o,s),e.pieAdvView(e.riskQuiz.multiplicative_risks),e.riskQuiz.client_risk=+o.toPrecision(4),e.recommendation="We recommend you see an eye-health professional ",o<=25?(e.recommendation+=" in the next two years.",e.recommendation_subtitle="Unless you've seen one in the last 2 years"):o<=50?(e.recommendation+=" in the next year.",e.recommendation_subtitle="Unless you've seen one in the last year"):o<=75?(e.recommendation+=" in the next 6 months.",e.recommendation_subtitle="Unless you've seen one recently."):(e.recommendation+=" ASAP.",e.recommendation_subtitle="Unless you've seen one recently."),null==e.id?e.riskResService.create(e.riskQuiz.toJSON()).subscribe(function(t){e.id=e.riskResService.id=t.id,e.share_url=e.idWithUrl()},console.error):e.share_url=e.idWithUrl()},console.error)},Ke([Object(r.ViewChild)("tweet"),et("design:type",HTMLAnchorElement)],e.prototype,"tweet",void 0),Ke([Object(r.Input)(),et("design:type",Je)],e.prototype,"riskQuiz",void 0),Ke([Object(r.Input)(),et("design:type",Object)],e.prototype,"submitted",void 0),Ke([Object(r.Output)(),et("design:type",r.EventEmitter)],e.prototype,"submittedChange",void 0),e=Ke([Object(r.Component)({selector:"app-risk-quiz-form-submitted",template:n("zd7U"),styles:[n("e6R8")]}),et("design:paramtypes",[c.a,c.b,u.b,Ve,He,te,f.a,ue])],e)}(),nt=[{path:"results",component:tt},{path:"results/:id",component:tt}],rt=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},it=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ot=function(){function e(){this.numToColour=Xe}return e.prototype.ngAfterViewInit=function(){},rt([Object(r.Input)(),it("design:type",Number)],e.prototype,"risk_value",void 0),e=rt([Object(r.Component)({selector:"app-risk-pointer",template:n("lEF6"),styles:[n("GFD+")]}),it("design:paramtypes",[])],e)}(),st=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},at=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ct=function(){function e(e,t){this.fb=e,this.riskStatsService=t,this.riskQuiz=new Je({}),this.submitted=!1,this.isCopied=!1,this.active=!0,this.formErrors={gender:"",age:"",ethnicity:"",myopia:"",diabetes:""},this.validationMessages={gender:{required:"Gender is required."},age:{required:"Age is required."},ethnicity:{required:"Ethnicity is required."}},this.doClose=function(){return document.getElementById("parent").focus()}}return e.prototype.ngAfterViewInit=function(){var e=this;this.riskStatsService.read("latest").subscribe(function(t){e.riskStatsService.risk_json=t.risk_json,e.ethnicity2study=Object($e.ethnicity2study)(e.riskStatsService.risk_json),e.all_ethnicities=e.ethnicities=Object.keys(e.ethnicity2study).sort()},console.error)},e.prototype.ngOnInit=function(){this.buildForm()},e.prototype.onSubmit=function(){this.submitted=!0,null!=this.riskForm.value.ethnicity&&this.riskForm.value.ethnicity.length&&this.riskForm.value.ethnicity instanceof Array&&(this.riskForm.value.ethnicity=this.riskForm.value.ethnicity[0].id),this.riskQuiz=new Je(this.riskForm.value)},e.prototype.addRisk=function(){var e=this;this.riskQuiz=new Je({}),this.buildForm(),this.active=!1,setTimeout(function(){return e.active=!0},0)},e.prototype.buildForm=function(){var e=this;this.riskForm=this.fb.group({age:[this.riskQuiz.riskQuiz.age,[a.h.required]],gender:[this.riskQuiz.riskQuiz.gender,[a.h.required]],ethnicity:[this.riskQuiz.riskQuiz.ethnicity,a.h.required],sibling:[this.riskQuiz.riskQuiz.sibling],parent:[this.riskQuiz.riskQuiz.parent],myopia:[this.riskQuiz.riskQuiz.myopia],diabetes:[this.riskQuiz.riskQuiz.diabetes]}),this.riskForm.valueChanges.subscribe(function(t){return e.onValueChanged(t)}),this.onValueChanged()},e.prototype.onValueChanged=function(e){if(this.riskForm){var t=this.riskForm;for(var n in this.formErrors)if(this.formErrors.hasOwnProperty(n)){this.formErrors[n]="";var r=t.get(n);if(r&&r.dirty&&!r.valid){var i=this.validationMessages[n];for(var o in r.errors)r.errors.hasOwnProperty(o)&&(this.formErrors[n]+=i[o]+" ");!0}}}},e.prototype.selected_ethnicity=function(e){null!=e&&e.length&&(this.riskQuiz.riskQuiz.ethnicity=this.riskForm.value.ethnicity=e[0].id)},e=st([Object(r.Component)({selector:"app-risk-quiz-form",template:n("4nrF"),styles:[n("SiWZ")]}),at("design:paramtypes",[a.a,Ve])],e)}(),lt=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},ut=function(){function e(){}return e=lt([Object(r.NgModule)({imports:[l.CommonModule,a.g,Qe.a,a.c,c.c,c.c.forChild(nt),Ee.a.forRoot(),Te.a.forRoot(),De.a.forRoot(),qe.b.forRoot(),Ge.b,Me.a,Fe.a,Ne.NgxChartsModule],providers:[Ve,He],declarations:[ct,tt,ot],exports:[ct]})],e)}(),ft=(n("MDfR"),this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}),pt=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},dt=function(){function e(e,t){this.router=e,this.alertsService=t}return e.prototype.intercept=function(e,t){var n=this;return t.handle(b.a.loggedIn()&&!e.url.startsWith("https://graph.microsoft.com")?e.clone({headers:e.headers.set("X-Access-Token",b.a.getAccessToken())}):e).catch(function(e){if(e instanceof s.d)switch(e.status){case 403:n.router.isActive("auth",!1)||n.router.isActive("/",!0)?console.warn({code:e.status,message:e.error.message}):(n.alertsService.add("Authentication required"),n.router.navigate(["auth"],{queryParams:{redirectUrl:n.router.url}}).then(function(e){return e||n.alertsService.add("Unable to route to /auth")}).catch(L.a.throw));break;default:return L.a.throw(e)}return L.a.throw(e)})},e=ft([Object(r.Injectable)(),pt("design:paramtypes",[c.b,f.a])],e)}(),ht=n("FQYD"),mt=[{path:"",component:ct},{path:"auth",loadChildren:"app/auth/auth.module#AuthModule"},{path:"admin",component:N}],gt=(n("a7sO"),n("1q7Z"),this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}),bt=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},vt=function(){function e(e,t,n,r,i,o,s){this.router=e,this.route=t,this.authService=n,this.appService=r,this.confService=i,this.msAuthService=o,this.alertsService=s}return e.prototype.ngOnInit=function(){var e=this;console.info("AppComponent::route.fragment =",this.route.fragment,";"),console.info("AppComponent::route.queryParams =",this.route.queryParams,";"),this.route.fragment.subscribe(function(t){var n=le(t);console.log("AppComponent::ngOnInit::ngOnInit::hash_fragment",n,";"),e.handleParams(n)}),this.route.queryParams.subscribe(function(t){console.info("AppComponent::ngOnInit::queryParams::params",t,";"),e.handleParams(t)})},e.prototype.handleParams=function(e){var t=this;!e||0===Object.keys(e).length&&e.constructor===Object||(console.info("AppComponent::handleParams::params:",e,";"),this.confService.get().subscribe(function(n){console.info("AppComponent::conf",n,";"),t.msAuthService.init();var r=function(){return t.router.navigateByUrl(e.hasOwnProperty("state")?decodeURIComponent(e.state):"/")};e.hasOwnProperty("code")?t.msAuthService.login("code",e.code,e.state):e.hasOwnProperty("refresh_token")?t.msAuthService.login("refresh_token",e.refresh_token,e.state):e.hasOwnProperty("access_token")?(t.confService.config.access_token=e.access_token,localStorage.setItem("ms::access_token",e.access_token),t.confService.post(t.confService.config).subscribe(function(){return r()})):e.hasOwnProperty("error")?(t.alertsService.add([e.error,e.error_description].join(": ")),console.error(e)):r()},console.error))},e.prototype.getBottom=function(){return{"margin-bottom":(this.alertsService.alerts.length?6*this.alertsService.alerts.length:6)+"em"}},e=gt([Object(r.Component)({selector:"glaucoma-risk-calculator",styles:[n("okgc")],template:n("5xMp")}),bt("design:paramtypes",[c.b,c.a,b.a,v.a,W,ue,f.a])],e)}(),yt=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},kt=function(){function e(){}return e=yt([Object(r.NgModule)({imports:[c.c,c.c.forRoot(mt),o.BrowserModule,s.c,a.c,O,ze,U,g.forRoot(),ut,ht.AuthModule,ye],declarations:[vt],providers:[v.a,b.a,D,{provide:s.a,useClass:dt,multi:!0},te],bootstrap:[vt]})],e)}();Object(r.enableProdMode)(),Object(i.a)().bootstrapModule(kt)},y69F:function(e,t){e.exports='<alert *ngFor="let alert of alertsService.alerts;let i = index" [type]="alert.type" dismissible="true"\n       (close)="closeAlert(i)"\n       style="color: #ffcc9a">\n  <h3>{{ alert?.msg }}</h3>\n</alert>\n'},zd7U:function(e,t){e.exports='<div *ngIf="submitted">\n  <div class="col" *ngIf="gauge">\n    <ng-gauge [bgRadius]=progressGraph.bgRadius\n              [bgColor]=progressGraph.bgColor\n              [rounded]=progressGraph.rounded\n              [reverse]=progressGraph.reverse\n              [animationSecs]=progressGraph.animationSecs\n              [labels]=progressGraph.labels\n              [segments]=progressGraph.segments>\n    </ng-gauge>\n  </div>\n  <h3 style="text-underline: single">\n    {{recommendation}}\n  </h3>\n  <h5 style="text-underline: single; font-style: italic;">\n    ({{recommendation_subtitle | lowercase}})\n  </h5>\n\n  <div class="card">\n    <div class="card-block">\n      <h2>Glaucoma prevalence in your population is: {{riskQuiz.risk}}%.</h2>\n\n      <h3>This puts you in the\n        <strong>{{most_at_risk}}</strong> most at risk subgroup.\n        <span *ngIf="added_risk">\n          Adding in <strong>family risk</strong>, and you have:\n          {{riskQuiz.client_risk}}% relative risk within your cohort.\n        </span>\n      </h3>\n    </div>\n  </div>\n\n  <h6>Based off submission:</h6>\n\n  <table class="table table-responsive table-striped">\n    <thead>\n    <tr>\n      <th *ngFor="let col of submissionHeader">\n        {{ col }}\n      </th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr>\n      <td *ngFor="let col of submissionHeader">\n        {{ submissionRow[col] }}\n      </td>\n    </tr>\n    </tbody>\n  </table>\n\n  <br>\n  <button class="btn btn-default" (click)="redo()">Redo</button>\n  <br>\n  <hr>\n  <h5>Share with family and friends to calculate their own risk</h5>\n  <div class="btn-toolbar" role="toolbar" aria-label="Share">\n    <div class="btn-group mr-2" role="group" aria-label="email">\n      <button class="btn btn-lg btn-warning" (click)="openModal(sendEmailTemplate)">Share as email</button>\n      <ng-template #sendEmailTemplate>\n        <div class="modal-body text-center">\n          <form class="container form-group">\n            <div class="row">\n              <div class="col-2">\n                <label class="col-form-label" for="email">\n                  To:\n                </label>\n              </div>\n              <div class="col-auto">\n                <input class="form-check-input" placeholder="Email" id="email" #toEmail>\n              </div>\n            </div>\n\n            <div class="row" [innerHtml]="getTemplate(\'email\') + \' \' + share_url"></div>\n            <button type="submit" class="btn" (click)="sendEmail(toEmail.value)"\n                    [disabled]="!toEmail.value.length" [ngClass]="{\'btn-outline-success\': toEmail.value.length}">\n              Send email\n            </button>\n          </form>\n        </div>\n      </ng-template>\n    </div>\n    <div class="btn-group mr-2" role="group" aria-label="facebook">\n      <a class="btn btn-lg btn-primary" [href]="\'https://www.facebook.com/sharer/sharer.php?u=\'+share_url"\n         target="_blank">\n        Share on facebook\n      </a>\n    </div>\n    <div class="btn-group mr-2" role="group" aria-label="twitter">\n      <a target="_blank" class="btn btn-lg btn-info" id="tweet" #tweet\n         [href]="\'https://twitter.com/intent/tweet?text=\'+getTemplate(\'twitter\')+\' \'+share_url"\n         data-size="large">\n        Tweet\n      </a>\n    </div>\n    <div class="btn-group" role="group" aria-label="copy-link">\n      <button class="btn btn-lg btn-outline" [class.btn-success]="isCopied" ngxClipboard\n              [cbContent]="share_url" (cbOnSuccess)="isCopied = true">\n        Copy link\n      </button>\n    </div>\n  </div>\n  <hr>\n  <button class="btn btn-secondary" (click)="toggleCollapse()" [class.btn-outline-secondary]="!isCollapsed">\n    Review references and submission\n  </button>\n  <div [collapse]="isCollapsed" class="card card-block card-header" *ngIf="!isCollapsed">\n    <div class="well well-lg">\n      <h6>Your submission</h6>\n\n      <div class="row">\n        <div class="col-xs-3"><em>Age</em></div>\n        <div class="col-xs-9  pull-left"><strong>&nbsp;{{ riskQuiz.riskQuiz.age }}</strong></div>\n      </div>\n      <div class="row">\n        <div class="col-xs-3"><em>Gender</em></div>\n        <div class="col-xs-9 pull-left"><strong>&nbsp;{{ riskQuiz.riskQuiz.gender }}</strong></div>\n      </div>\n      <div class="row">\n        <div class="col-xs-3"><em>Ethnicity</em></div>\n        <div class="col-xs-9 pull-left"><strong>&nbsp;{{ riskQuiz.riskQuiz.ethnicity }}</strong></div>\n      </div>\n      <div class="row">\n        <div class="col-xs-3"><em>Sibling with glaucoma</em></div>\n        <div class="col-xs-9 pull-left"><strong>&nbsp;{{ riskQuiz.riskQuiz.sibling || \'false\' }}</strong></div>\n      </div>\n      <div class="row" style="margin-bottom: 5px">\n        <div class="col-xs-3"><em>Parent with glaucoma</em></div>\n        <div class="col-xs-9 pull-left"><strong>&nbsp;{{ riskQuiz.riskQuiz.parent || \'false\' }}</strong></div>\n      </div>\n\n      \x3c!--<app-risk-pointer [risk_value]="riskQuiz.client_risk"></app-risk-pointer>--\x3e\n\n      <ngx-charts-pie-grid *ngIf="pie_grid"\n                           [view]="pieView"\n                           [scheme]="colorScheme"\n                           [results]="pieData"\n                           autoScale="true"\n                           (select)="onPieGridSelect($event)">\n      </ngx-charts-pie-grid>\n\n      <hr>\n\n      \x3c!--\n      (legendLabelClick)="onLegendLabelClick($event)"\n      [scheme]="colorScheme"\n      [gradient]="gradient"\n      (select)="treemapSelect($event)"--\x3e\n      <h4>Risk compared with other ethnicities of same age and gender</h4>\n      <div class="row" *ngIf="show_treemap">\n        <p>Hover over each box to view the comparative risk score.</p>\n        <ngx-charts-tree-map [labelFormatting]="labelFormat"\n                             [results]="riskQuiz.relative_risks.graphed_rr">\n        </ngx-charts-tree-map>\n\n        <table class="table table-responsive table-striped">\n          <thead>\n          <tr>\n            <th>Study</th>\n            <th>Prevalence</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr *ngFor="let leg of treemap_legend" [style.background-color]="leg.color">\n            <td>\n              {{leg.name}}\n            </td>\n            <td>\n              {{leg.value}}\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n\n      \x3c!--\n      <div class="row">\n        <pre>multiplicative_risks = {{riskQuiz.multiplicative_risks|json}}</pre>\n      </div>\n      <div class="row">\n        <pre>relative_risks = {{riskQuiz.relative_risks|json}}</pre>\n      </div>\n      --\x3e\n\n      \x3c!--\n      <h4>Other charts</h4>\n\n      <div class="container-fluid">\n        <div class="row justify-content-md-center">\n          <div class="col" *ngIf="show_pie_adv">\n            <ngx-charts-advanced-pie-chart [view]="pieAdvDim"\n                                           [scheme]="pieAdvColorScheme"\n                                           [results]="pieAdvData"\n                                           [gradient]="pieAdvGradient"\n\n                                           (select)="pieAdvOnSelect($event)">\n            </ngx-charts-advanced-pie-chart>\n            \x3c!-- [total-label]="pieAdvLabel" --\x3e\n      \x3c!--\n          </div>\n        </div>\n      </div>\n      --\x3e\n\n      <h4>Notes</h4>\n      <ul *ngFor="let note of notes">\n        <li>{{note}}</li>\n      </ul>\n      <ul>\n        <li [innerHTML]="html_of_last_note"></li>\n      </ul>\n\n      <h4>References</h4>\n      <div [innerHTML]="html_of_all_refs"></div>\n    </div>\n  </div>\n</div>\n'}},[0]);